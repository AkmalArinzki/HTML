<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>FPS Web Game</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
      }
      canvas {
        display: block;
      }
      #crosshair {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 30px;
        pointer-events: none;
      }
      #hud {
        position: fixed;
        top: 10px;
        left: 10px;
        color: white;
        font-size: 20px;
        font-weight: bold;
        pointer-events: none;
      }
      #win-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        font-size: 40px;
        font-family: Arial;
        z-index: 99;
      }
      #win-screen button {
        padding: 10px 20px;
        margin-top: 20px;
        font-size: 20px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="crosshair">+</div>
    <div id="hud">Shoot: 0</div>

    <div id="win-screen">
      <div id="win-text">MENANG!</div>
      <button onclick="restartGame()">Main Lagi</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
      // --------------------------------------------------
      //  BASIC SETUP
      // --------------------------------------------------
      let scene = new THREE.Scene();
      let camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );

      let renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      camera.position.y = 2;

      // floor
      let floor = new THREE.Mesh(
        new THREE.BoxGeometry(100, 1, 100),
        new THREE.MeshBasicMaterial({ color: 0x333333 })
      );
      floor.position.y = -1;
      scene.add(floor);

      // --------------------------------------------------
      // HUD VARIABLES
      // --------------------------------------------------
      let shootCount = 0;
      let killCount = 0;

      const hud = document.getElementById("hud");
      const winScreen = document.getElementById("win-screen");

      function updateHUD() {
        hud.textContent = `Shoot: ${shootCount}`;
      }

      // --------------------------------------------------
      // PLAYER MOVEMENT
      // --------------------------------------------------
      let keys = {};

      document.addEventListener("keydown", (e) => (keys[e.key] = true));
      document.addEventListener("keyup", (e) => (keys[e.key] = false));

      document.body.addEventListener("click", () => {
        document.body.requestPointerLock();
        shootGun();
      });

      let pitch = 0;
      let yaw = 0;

      document.addEventListener("mousemove", (e) => {
        if (document.pointerLockElement === document.body) {
          yaw -= e.movementX * 0.002;
          pitch -= e.movementY * 0.002;
          pitch = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, pitch));
        }
      });

      // --------------------------------------------------
      // GUN (simple block)
      // --------------------------------------------------
      let gun = new THREE.Mesh(
        new THREE.BoxGeometry(0.3, 0.2, 1),
        new THREE.MeshBasicMaterial({ color: 0x8888ff })
      );
      gun.position.set(0.3, -0.2, -0.8);
      camera.add(gun);
      scene.add(camera);

      // --------------------------------------------------
      // ENEMIES
      // --------------------------------------------------
      let enemies = [];

      function spawnEnemy() {
        let enemy = new THREE.Mesh(
          new THREE.BoxGeometry(1, 2, 1),
          new THREE.MeshBasicMaterial({ color: 0xff0000 })
        );
        enemy.position.set(
          Math.random() * 60 - 30,
          0,
          Math.random() * -40 - 10
        );
        enemy.health = 1;
        scene.add(enemy);
        enemies.push(enemy);
      }

      function spawnWave() {
        for (let i = 0; i < 5; i++) spawnEnemy();
      }

      spawnWave();

      // --------------------------------------------------
      // SHOOT MECHANIC
      // --------------------------------------------------
      const raycaster = new THREE.Raycaster();

      function shootGun() {
        shootCount++;
        updateHUD();

        raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
        let hits = raycaster.intersectObjects(enemies);

        if (hits.length > 0) {
          let target = hits[0].object;
          killEnemy(target);
        }
      }

      function killEnemy(enemy) {
        scene.remove(enemy);
        enemies = enemies.filter((e) => e !== enemy);

        killCount++;

        if (killCount >= 20) showWinScreen();

        // respawn enemy
        spawnEnemy();
      }

      // --------------------------------------------------
      // WIN SCREEN
      // --------------------------------------------------
      function showWinScreen() {
        winScreen.style.display = "flex";
      }

      function restartGame() {
        winScreen.style.display = "none";

        shootCount = 0;
        killCount = 0;
        updateHUD();

        // remove old enemies
        enemies.forEach((e) => scene.remove(e));
        enemies = [];

        spawnWave();
      }

      // --------------------------------------------------
      // GAME LOOP
      // --------------------------------------------------
      function animate() {
        requestAnimationFrame(animate);

        let speed = 0.1;
        let dir = new THREE.Vector3();

        if (keys["w"]) dir.z -= 1;
        if (keys["s"]) dir.z += 1;
        if (keys["a"]) dir.x -= 1;
        if (keys["d"]) dir.x += 1;

        dir.applyAxisAngle(new THREE.Vector3(0, 1, 0), yaw);
        camera.position.addScaledVector(dir, speed);

        camera.rotation.order = "YXZ";
        camera.rotation.y = yaw;
        camera.rotation.x = pitch;

        // Enemy AI (they slowly walk toward you)
        enemies.forEach((enemy) => {
          let vec = new THREE.Vector3();
          vec.subVectors(camera.position, enemy.position).normalize();
          enemy.position.addScaledVector(vec, 0.02);
        });

        renderer.render(scene, camera);
      }

      animate();
    </script>
  </body>
</html>
